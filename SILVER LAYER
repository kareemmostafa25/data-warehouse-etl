-------------------------------------------------
-- SILVER LAYER   ---->   Transformation
-------------------------------------------------
CREATE PROCEDURE silver.load_silver AS
BEGIN
    ------------------------------------------
    -- 1. CRM_CUST_INFO
    ------------------------------------------
    TRUNCATE TABLE silver.crm_cust_info;
    INSERT INTO silver.crm_cust_info (...)
    SELECT ... FROM (
        SELECT *,
               ROW_NUMBER() OVER (PARTITION BY cst_id ORDER BY cst_create_date DESC) AS flag_last
        FROM bronze.crm_cust_info
        WHERE cst_id IS NOT NULL
    ) t
    WHERE flag_last = 1;

    ------------------------------------------
    -- 2. CRM_PRD_INFO
    ------------------------------------------
    TRUNCATE TABLE silver.crm_prd_info;
    INSERT INTO silver.crm_prd_info (...)
    SELECT ... FROM bronze.crm_prd_info;

    ------------------------------------------
    -- 3. CRM_SALES_DETAILS
    ------------------------------------------
    TRUNCATE TABLE silver.crm_sales_details;
    INSERT INTO silver.crm_sales_details (...)
    SELECT ... FROM bronze.crm_sales_details;

    ------------------------------------------
    -- 4. ERP_CUST_AZ12
    ------------------------------------------
    TRUNCATE TABLE silver.erp_cust_az12;
    INSERT INTO silver.erp_cust_az12 (...)
    SELECT ... FROM bronze.erp_cust_az12;

    ------------------------------------------
    -- 5. ERP_LOC_A101
    ------------------------------------------
    TRUNCATE TABLE silver.erp_loc_a101;
    INSERT INTO silver.erp_loc_a101 (...)
    SELECT ... FROM bronze.erp_loc_a101;

    ------------------------------------------
    -- 6. ERP_PX_CAT_G1V2
    ------------------------------------------
    TRUNCATE TABLE silver.erp_px_cat_g1v2;
    INSERT INTO silver.erp_px_cat_g1v2 (...)
    SELECT ... FROM bronze.erp_px_cat_g1v2;
